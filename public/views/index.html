<html>
<head>
  <title>My Canvas App</title>
  <!-- stylesheet -->
  <link rel="stylesheet" type="text/css" href="https://necolas.github.io/normalize.css/3.0.2/normalize.css">
</head>
<body>
  <h3>Please select the product related to this case</h3>
 <button id='link'>Click Me</button>
    <script src="https://ajax.deskapi.com/libs/desk/canvas/1.0.0/desk-canvas-all.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
   <script>
      Desk.canvas(function() {
        Desk.canvas.client.refreshSignedRequest(function(data) {
          if (data.status === 200) {
            var sr       = data.payload.response.split('.')[1]
              , ctx      = JSON.parse(Desk.canvas.decode(sr))
              , url      = ctx.context.environment.case.url + '/replies/draft'
              , reply_data = ''
            $('button').click(function() {
              Desk.canvas.client.ajax(url, {
                client: ctx.client,
                method: 'GET',
                success: function(rsp) {
                  console.log(rsp);
                  console.log(rsp.payload.body);
                  reply_data = rsp.payload.body
                }
              });
              var body = {body: reply_data, subject: "test",
                _links: {
                  topic: {
                    href: "/api/v2/topics/642669",
                    class: "topic"
                  }
                }};
              console.log(JSON.stringify(body));
              
              Desk.canvas.client.ajax(url,
                {client : ctx.client,
                  method: 'POST',
                  data: JSON.stringify(body),
                  success : function(data) {
                  if (201 === data.status) {
                    alert("Success");
                    console.log(data.payload.id)
                  } else {
                   alert("post article failed");
                   console.log(data);
                   console.log(data.payload)
                }
                }
              })
            })
          }
        })
      })
   </script>

</body>
</html>
